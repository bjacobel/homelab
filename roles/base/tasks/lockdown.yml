---
- name: Edit sshd_config to disable password auth
  become: true
  lineinfile:
    path: /etc/ssh/sshd_config
    regex: ^(# *)?PasswordAuthentication
    line: PasswordAuthentication no
  notify:
    - Restart ssh service

- name: Remove unused users
  become: true
  user:
    name: "{{ item }}"
    state: absent
    remove: true
    force: true
  loop:
    - debian
    - vagrant

- name: Create sshers group
  become: true
  group:
    name: sshers
    state: present

- name: "Put user in sshers group: {{ ansible_ssh_user }}"
  become: true
  user:
    name: "{{ ansible_ssh_user }}"
    groups: sshers
    append: true

- name: Configure ssh so that only sshers can ssh
  become: true
  lineinfile:
    path: /etc/ssh/sshd_config
    regex: ^(# *)?AllowGroups
    line: AllowGroups sshers
  notify:
    - Restart ssh service

# @TODO: enable UFW
# https://github.com/imthenachoman/How-To-Secure-A-Linux-Server#firewall-with-ufw-uncomplicated-firewall

# @TODO: set up clamav?
# https://github.com/imthenachoman/How-To-Secure-A-Linux-Server#anti-virus-scanning-with-clamav-wip
