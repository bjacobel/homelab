- name: edit sshd_config to disable password auth
  become: true
  lineinfile:
    path: /etc/ssh/sshd_config
    regex: ^(# *)?PasswordAuthentication
    line: PasswordAuthentication no
  notify:
    - restart-ssh-service

- name: remove unused users
  become: true
  user:
    name: "{{item}}"
    state: absent
    remove: true
    force: true
  loop:
    - debian
    - vagrant

- name: create sshers group
  become: true
  group:
    name: sshers
    state: present

- name: put {{ ansible_ssh_user }} in sshers group
  become: true
  user:
    name: "{{ ansible_ssh_user }}"
    groups: sshers
    append: true

- name: configure ssh so that only sshers can ssh
  become: true
  lineinfile:
    path: /etc/ssh/sshd_config
    regex: ^(# *)?AllowGroups
    line: AllowGroups sshers
  notify:
    - restart-ssh-service

# @TODO: enable UFW
# https://github.com/imthenachoman/How-To-Secure-A-Linux-Server#firewall-with-ufw-uncomplicated-firewall

# @TODO: set up clamav?
# https://github.com/imthenachoman/How-To-Secure-A-Linux-Server#anti-virus-scanning-with-clamav-wip
